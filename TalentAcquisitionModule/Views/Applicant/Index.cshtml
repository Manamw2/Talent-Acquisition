@model IEnumerable<JobViewModel>

@{
    ViewData["Title"] = "Job Board";
    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
}

<div class="container-fluid">
    <div class="row">
        <!-- Left Sidebar -->
        <div class="col-md-3 border-end p-4">
            <h5 class="mb-4">Latest Jobs</h5>
            <div class="list-group">
                @foreach (var job in Model)
                {
                    <a href="#" class="list-group-item list-group-item-action job-card"
                       data-job-id="@job.JobId"
                       data-job-title="@job.Title"
                       data-job-location="@job.DepartmentName"
                       data-job-description="@job.Description"
                       data-job-application-count="@job.ApplicationCount"
                       data-job-type="@job.JobType">
                        <h6 class="mb-1">@job.Title</h6>
                        <div class="job-location">📍 SoftTrend Headquarter</div>
                        <div class="mb-1">@job.DepartmentName</div>
                        <div class="category-tag mt-1">Valid till: @job.EndDate.ToString("yyyy-MM-dd")</div>
                    </a>
                }

            </div>
            <br />
            <!-- Pagination Controls -->
            <nav aria-label="Page navigation">
                <ul class="pagination custom-pagination">
                    <!-- Previous Button -->
                    <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = currentPage - 1 })">Previous</a>
                    </li>

                    <!-- Page Numbers -->
                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                        </li>
                    }

                    <!-- Next Button -->
                    <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = currentPage + 1 })">Next</a>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="col-md-6 p-4">
            <div class="job-detail-card">
                @if (Model.Any())
                {
                    var firstJob = Model.First();
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <h4 id="job-title">@firstJob.Title</h4>
                        <button id="applyButton" data-job-id="@firstJob.JobId" class="btn btn-primary">
                            Apply for this Job
                        </button>
                    </div>
                    <div class="job-description" id="job-description">
                        <h5>Description:</h5>
                        <hr />
                        @Html.Raw(firstJob.Description)

                        <div class="mt-3">
                            <span class="badge bg-info">@firstJob.ApplicationCount Applications</span>
                            <span class="badge bg-secondary ms-2">@firstJob.JobType</span>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-3 border-start p-4">
            <h5 class="mb-4">Filter by Job Type</h5>
            <select class="form-select filter-dropdown" id="job-type-filter">
                <option value="all">All</option>
                @foreach (JobType jobType in Enum.GetValues(typeof(JobType)))
                {
                    <option value="@jobType.ToString().ToLower()">@jobType</option>
                }
            </select>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#applyButton").click(function () {
                var jobId = $(this).data("job-id");
                console.log(jobId);
                var baseUrl = window.location.origin + '/TalentAcquisition/Applicants/ApplyForJob';
                console.log(baseUrl);

                $.ajax({
                    url: baseUrl,
                    type: 'GET',
                    contentType: 'application/x-www-form-urlencoded',
                    data: {
                        jobId: parseInt(jobId),
                    },
                    success: function (response) {
                        if (response.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Success!',
                                text: response.message,
                                confirmButtonText: 'OK'
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: response.message,
                                confirmButtonText: 'OK'
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: "An error occurred: " + xhr.responseText,
                            confirmButtonText: 'OK'
                        });
                        console.log("XHR:", xhr);
                    }
                });
            });
        });

    </script>
    <script src="~/js/job-board.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    }

